<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    />
  </head>
  <body>
    <!-- #############  SignUp Modal ############## Start ############## -->
    <div class="modal fade" id="signup-modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">User SignUp</h4>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body px-5">
            <form id="signup_form">
              <div class="mb-3">
                <label for="uname" class="form-label">User Name</label>
                <input type="text" class="form-control" id="uname" />
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" class="form-control" id="password" />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary me-4" id="signup_btn">
              SignUp
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- #############  SignUp Modal ############## End ############## -->

    <!-- #############  SignIn Offcanvas ############## Start ############## -->

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <div class="offcanvas offcanvas-start" id="signin_offcanvas">
      <div
        class="toast  position-fixed top-0 start-0 m-2"
        id="signin_error"
      >
        <div class="toast-header text-light fw-bold text-bg-danger">
          Sorry SignIn Failed... Either email or password is Incorrect....
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="toast"
          ></button>
        </div>
        
      </div>
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">User SignIn</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
        ></button>
      </div>
      <div class="offcanvas-body px-4">
        <form
          id="signin_form"
          class="border border-secondary rounded p-5 bg-secondary-subtle shadow-lg"
        >
          <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" class="form-control" id="_email" />
          </div>
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="_password" />
          </div>
          <button type="button" class="btn btn-primary" id="signin_btn">
            SignIn
          </button>
        </form>
      </div>
    </div>
    <!-- #############  SignIn Offcanvas ############## End ############## -->

    <div class="container">
      <div class="row bg-primary-subtle">
        <div class="col py-3 ps-4">
          <img src="logo.png" style="width: 45px" />
          <h4 class="d-inline-block ms-2 text-primary-emphasis">ISRDC INC.</h4>
        </div>
        <div class="col text-end py-3">
          <button
            type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#signup-modal"
            id="sup"
          >
            SignUp
          </button>
          <button
            type="button"
            class="btn btn-success me-3 ms-2"
            id="sin"
            data-bs-toggle="offcanvas"
            data-bs-target="#signin_offcanvas"
          >
            SignIn
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // ############### SignIn Fields ################# start ##############
      const signinBtn = document.querySelector("#signin_btn");
      const signinError = document.querySelector("#signin_error");
      const signinErrorToast = bootstrap.Toast.getOrCreateInstance(signinError);
      const _email = document.querySelector("#_email");
      const _password = document.querySelector("#_password");

      const signinOffcanvas = new bootstrap.Offcanvas("#signin_offcanvas");
      const signinForm = document.querySelector("#signin_form");

      // ############### SignIn Fields ################# end ##############

      // ############### SignUp Fields ################# start ##############
      const uname = document.querySelector("#uname");
      const email = document.querySelector("#email");
      const password = document.querySelector("#password");

      const signupModal = new bootstrap.Modal("#signup-modal");
      const signupBtn = document.querySelector("#signup_btn");
      const signupForm = document.querySelector("#signup_form");
      // ############### SignUp Fields ################# end ##############

      // ############### SignIn ################# start ##############
      signinBtn.
        addEventListener("click", () => {
          const signinReq = new XMLHttpRequest();

          signinReq.open(
            "get",
            "signin.do?email=" + _email.value + "&password=" + _password.value,
            true
          );

          signinReq.addEventListener("readystatechange", () => {
            if (signinReq.readyState == 4 && signinReq.status == 200) {
              // console.log(signinReq.responseText , '~~~~~~~~~~~`');
              const flag = signinReq.responseText;
              if (flag == "true") {
                signinOffcanvas.hide();
                signinForm.reset();
              } else {
                signinErrorToast.show();
              }
            }
          });

          signinReq.send();
        });
      // ############### SignIn ################# end ##############

      // ############### SignUp ################# start ##############
      signupBtn.addEventListener("click", () => {
        const signupReq = new XMLHttpRequest();

        signupReq.open(
          "get",
          "signup.do?uname=" +
            uname.value +
            "&email=" +
            email.value +
            "&password=" +
            password.value,
          true
        );

        signupReq.addEventListener("readystatechange", () => {
          if (signupReq.readyState == 4 && signupReq.status == 200) {
            let resp = signupReq.responseText;

            // console.log(resp, typeof resp);
            if (resp == "true") {
              signupForm.reset();
              signupModal.hide();
            }
          }
        });
        signupReq.send();
      });
      // ############### SignUp ################# End ##############
    </script>
  </body>
</html>
